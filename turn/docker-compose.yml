services:
  coturn:
    image: coturn/coturn:4.6.2
    container_name: spacerally-coturn
    restart: unless-stopped
    network_mode: host
    environment:
      # Set this in your shell or in an .env file on the server.
      # Must match the signaling server's TURN_SHARED_SECRET.
      TURN_SHARED_SECRET: ${TURN_SHARED_SECRET}
    command:
      - -c
      - /etc/coturn/turnserver.conf
      - --static-auth-secret=${TURN_SHARED_SECRET}
    volumes:
      - ./turnserver.conf:/etc/coturn/turnserver.conf:ro
    # With network_mode: host, ports are bound directly on the host.
    # Make sure your firewall allows:
    # - 3478/udp and 3478/tcp (TURN)
    # - relay port range (see turnserver.conf)
