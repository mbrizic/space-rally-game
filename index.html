<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Space Delivery ‚Äî SCRAPS</title>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      background: #0b0d12;
      color: #e8ecf1;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
        "Segoe UI Emoji";
      overflow: hidden;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
    }

    #app {
      height: 100%;
      display: grid;
      grid-template-rows: 1fr;
      position: relative;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --pad: clamp(10px, 2.2vmin, 22px);
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Simplified Net / Invite UI */
    #net-panel {
      position: absolute;
      left: 15px;
      top: 15px;
      z-index: 100;
      pointer-events: auto;
    }

    /* Start Menu (forces a user gesture for audio + fullscreen) */
    #start-menu {
      position: absolute;
      inset: 0;
      z-index: 180;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      pointer-events: auto;
      background:
        radial-gradient(1200px 900px at 20% 15%, rgba(66, 110, 255, 0.12), rgba(0, 0, 0, 0) 55%),
        radial-gradient(900px 800px at 85% 80%, rgba(34, 197, 94, 0.08), rgba(0, 0, 0, 0) 60%),
        linear-gradient(180deg, rgba(11, 13, 18, 0.85), rgba(11, 13, 18, 0.72));
      backdrop-filter: blur(10px);
    }

    body.started #start-menu {
      display: none;
    }

    #start-menu .card {
      width: min(520px, calc(100vw - 40px));
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(255, 255, 255, 0.06);
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 24px 70px rgba(0, 0, 0, 0.35);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    /* Subtle grime/scan overlay for the whole card */
    #start-menu .card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        repeating-linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.05) 0px,
          rgba(255, 255, 255, 0.03) 1px,
          rgba(0, 0, 0, 0) 3px,
          rgba(0, 0, 0, 0) 7px
        );
      opacity: 0.08;
      mix-blend-mode: overlay;
    }

    #start-menu .card::after {
      content: "";
      position: absolute;
      inset: -30px;
      pointer-events: none;
      background:
        radial-gradient(120px 80px at 12% 28%, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0) 70%),
        radial-gradient(140px 90px at 80% 22%, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0) 70%),
        radial-gradient(180px 120px at 78% 82%, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0) 70%);
      opacity: 0.22;
      filter: blur(1px);
    }

    #start-menu .logo-wrap {
      display: grid;
      place-items: center;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    #start-menu .game-name {
      position: relative;
      z-index: 1;
      margin: 0 0 10px;
      font-weight: 1000;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      font-size: clamp(15px, 2.8vmin, 22px);
      line-height: 1.15;
      color: rgba(245, 248, 255, 0.98);
      text-shadow:
        0 2px 0 rgba(0, 0, 0, 0.55),
        0 0 26px rgba(120, 200, 255, 0.18),
        0 14px 38px rgba(0, 0, 0, 0.35);
    }

    #start-menu .game-name .sub {
      display: inline-block;
      margin-left: 8px;
      letter-spacing: 0.14em;
      font-size: 0.92em;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.96), rgba(255, 220, 140, 0.95), rgba(255, 255, 255, 0.96));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      text-shadow: none;
    }

    @media (prefers-reduced-motion: no-preference) {
      #start-menu .game-name .sub {
        background-size: 220% 100%;
        animation: title-sheen 5.5s ease-in-out infinite;
      }
    }

    @keyframes title-sheen {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    #start-menu svg.scraps-logo {
      width: min(480px, calc(100vw - 70px));
      height: auto;
      display: block;
      filter: drop-shadow(0 20px 44px rgba(0, 0, 0, 0.45));
    }

    #start-menu .corp-tag {
      position: relative;
      z-index: 1;
      margin-top: 2px;
      margin-bottom: 10px;
      font-weight: 950;
      letter-spacing: 0.28em;
      font-size: 11px;
      opacity: 0.9;
      text-transform: uppercase;
    }

    #start-menu .corp-tag .tiny {
      opacity: 0.7;
      letter-spacing: 0.18em;
      font-weight: 850;
      display: block;
      margin-top: 5px;
      font-size: 10px;
    }

    /* #start-menu title is replaced by the SVG logo */

    #start-menu .sub {
      opacity: 0.85;
      font-size: 13px;
      line-height: 1.35;
      margin-bottom: 14px;
      position: relative;
      z-index: 1;
    }

    #start-menu .row {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    /* Submenus: consistent vertical spacing between rows */
    #menu-singleplayer .row + .row {
      margin-top: 12px;
    }

    /* Root menu: the two big entry buttons are stacked (one per row). */
    #menu-root .row + .row {
      margin-top: 12px;
    }

    #start-menu .menu-btn {
      min-width: 280px;
      min-height: 54px;
      height: auto;
      border-radius: 999px;
      border: none;
      font-weight: 950;
      letter-spacing: 0.08em;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.28);
      padding: 14px 20px;
      line-height: 1.15;
      white-space: normal;
    }

    @media (prefers-reduced-motion: no-preference) {
      #start-menu svg.scraps-logo {
        animation: scraps-float 4.5s ease-in-out infinite;
      }
    }

    @keyframes scraps-float {
      0% { transform: translateY(0px) rotate(-0.15deg); }
      50% { transform: translateY(-3px) rotate(0.12deg); }
      100% { transform: translateY(0px) rotate(-0.15deg); }
    }

    #btn-start {
      background: #22C55E;
      color: rgba(10, 13, 18, 0.95);
    }

    #btn-host-driver,
    #btn-join-codriver,
    #btn-join-confirm {
      background: #3B82F6;
      color: rgba(255, 255, 255, 0.98);
    }

    #btn-join-codriver,
    #btn-join-confirm {
      background: #0EA5E9;
    }

    #start-menu .divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.12);
      margin: 14px 0;
    }

    #start-menu .code {
      font-weight: 950;
      letter-spacing: 0.18em;
      font-size: 28px;
      margin: 10px 0 2px;
    }

    #start-menu .hint {
      opacity: 0.85;
      font-size: 12px;
      margin-bottom: 8px;
    }

    #start-menu input.code-input {
      width: 170px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(255, 255, 255, 0.08);
      color: rgba(255, 255, 255, 0.98);
      font-weight: 900;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      text-align: center;
      outline: none;
    }

    #start-menu .error {
      color: rgba(255, 110, 110, 0.98);
      font-size: 12px;
      min-height: 16px;
      margin-top: 8px;
    }

      /* Finish panel (vote + submit score) */
      #finish-panel {
        position: absolute;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: calc(var(--safe-top) + var(--pad)) calc(var(--safe-right) + var(--pad)) calc(var(--safe-bottom) + var(--pad)) calc(var(--safe-left) + var(--pad));
        background: rgba(0, 0, 0, 0.55);
        z-index: 210;
        pointer-events: auto;
      }

      /* Visibility is controlled by game logic (JS). */

      #finish-panel .card {
        width: min(640px, 92vw);
        background: rgba(15, 18, 24, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.14);
        border-radius: 14px;
        padding: 18px;
        box-shadow: 0 16px 45px rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(8px);
      }

      #finish-panel .title {
        font-size: 30px;
        font-weight: 950;
        letter-spacing: 0.10em;
        text-align: center;
        color: rgba(255, 255, 255, 0.96);
      }

      #finish-panel .sub {
        margin-top: 6px;
        color: rgba(255, 255, 255, 0.70);
        font-size: 14px;
        line-height: 1.25;
        text-align: center;
      }

      #finish-panel .row {
        margin-top: 12px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      #finish-panel input.name-input {
        flex: 1;
        min-width: 170px;
        height: 44px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(0, 0, 0, 0.35);
        color: rgba(255, 255, 255, 0.92);
        padding: 0 12px;
        font-size: 15px;
        outline: none;
      }

      #finish-panel .finish-btn {
        min-height: 44px;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(70, 90, 255, 0.85);
        color: rgba(255, 255, 255, 0.95);
        font-weight: 800;
        letter-spacing: 0.02em;
        cursor: pointer;
        user-select: none;
      }

      #finish-panel .finish-btn:active {
        transform: translateY(1px);
      }

      #finish-panel .finish-btn.secondary {
        background: rgba(55, 65, 81, 0.88);
      }

      #finish-panel .finish-btn.up {
        background: rgba(34, 197, 94, 0.88);
      }

      #finish-panel .finish-btn.down {
        background: rgba(239, 68, 68, 0.88);
      }

      #finish-panel .toggle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(0, 0, 0, 0.22);
        color: rgba(255, 255, 255, 0.82);
        font-weight: 800;
        letter-spacing: 0.02em;
        user-select: none;
      }

      #finish-panel .toggle input {
        width: 18px;
        height: 18px;
      }

      #finish-panel .hint {
        margin-top: 10px;
        color: rgba(255, 255, 255, 0.62);
        font-size: 12px;
      }

      #finish-panel .board {
        margin-top: 12px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.10);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        color: rgba(255, 255, 255, 0.78);
        font-size: 12px;
        white-space: pre;
      }

    #net-invite {
      background: #3B82F6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.05em;
      box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.4);
      transition: all 0.2s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #net-invite:hover {
      background: #2563EB;
      transform: translateY(-1px);
      box-shadow: 0 6px 20px 0 rgba(59, 130, 246, 0.5);
    }

    #net-invite:active {
      background: #1D4ED8;
      transform: translateY(0);
    }

    /* Hidden legacy/debug elements */
    #net-room-container,
    #net-status-container {
      display: none;
    }

    /* Wrecked Reset Button (shown via JS) */
    #btn-reset {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, 68px);
      z-index: 175;
      display: none;
      pointer-events: auto;

      background: #EF4444;
      color: rgba(255, 255, 255, 0.98);
      border: none;
      padding: 14px 22px;
      border-radius: 999px;
      font-weight: 950;
      letter-spacing: 0.08em;
      box-shadow: 0 12px 34px rgba(239, 68, 68, 0.35);
      cursor: pointer;
    }

    #btn-reset:active {
      transform: translate(-50%, 68px) scale(0.98);
    }

    /* Mobile Overlay (landscape-first) */
    #mobile-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: none;
      /* Shown via JS */
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-drag: none;

      --btn: clamp(58px, 11vmin, 96px);
      --btn-sm: clamp(46px, 9vmin, 76px);
      --joy: clamp(140px, 26vmin, 240px);
      --joy-knob: clamp(54px, 10vmin, 90px);
    }

    #mobile-overlay .touch-auto {
      pointer-events: auto;
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* Role toggle button (touch only; wired in game.ts) */
    #role-toggle {
      position: absolute;
      top: calc(var(--pad) + var(--safe-top));
      right: calc(var(--pad) + var(--safe-right));
      z-index: 120;
      pointer-events: auto;

      background: rgba(255, 255, 255, 0.10);
      border: 2px solid rgba(255, 255, 255, 0.18);
      color: rgba(255, 255, 255, 0.95);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 12px;
      letter-spacing: 0.04em;
      user-select: none;
    }

    #role-toggle:active {
      transform: scale(0.98);
      background: rgba(255, 255, 255, 0.16);
    }

    /* Fullscreen exit (touch only; wired in main.ts) */
    #fullscreen-toggle {
      display: none;
      position: absolute;
      top: calc(var(--pad) + var(--safe-top));
      left: calc(var(--pad) + var(--safe-left));
      z-index: 120;
      pointer-events: auto;

      background: rgba(255, 255, 255, 0.10);
      border: 2px solid rgba(255, 255, 255, 0.18);
      color: rgba(255, 255, 255, 0.95);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: 0.06em;
      user-select: none;
    }

    #fullscreen-toggle:active {
      transform: scale(0.98);
      background: rgba(255, 255, 255, 0.16);
    }

    /* Navigator ammo indicator (above weapon buttons) */
    #ammo-display {
      position: absolute;
      right: calc(var(--pad) + var(--safe-right));
      bottom: calc(var(--pad) + var(--safe-bottom) + var(--btn-sm) + 10px);
      padding: 8px 10px;
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.16);
      color: rgba(255, 255, 255, 0.92);
      font-weight: 950;
      letter-spacing: 0.04em;
      font-size: 14px;
      pointer-events: none;
      user-select: none;
      z-index: 170;
    }

    /* Hide touch controls until the user starts (start menu handles the first gesture). */
    body:not(.started) #mobile-overlay .control-group,
    body:not(.started) #role-toggle,
    body:not(.started) #fullscreen-toggle,
    body:not(.started) #bullet-time-zone {
      display: none;
    }

    /* Portrait helper: encourage landscape */
    #mobile-rotate {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 24px;
      z-index: 200;
      pointer-events: auto;
      background: rgba(11, 13, 18, 0.92);
      backdrop-filter: blur(10px);
    }

    #mobile-rotate .card {
      max-width: 420px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      padding: 18px 16px;
    }

    #mobile-rotate .title {
      font-weight: 900;
      letter-spacing: 0.02em;
      font-size: 18px;
      margin-bottom: 6px;
    }

    #mobile-rotate .sub {
      opacity: 0.8;
      font-size: 13px;
      line-height: 1.35;
    }

    @media (orientation: portrait) and (hover: none) and (pointer: coarse) {
      #mobile-overlay {
        display: block;
      }

      #mobile-rotate {
        display: flex;
      }

      #mobile-overlay .control-group,
      #role-toggle {
        opacity: 0.25;
        filter: blur(0.6px);
      }
    }

    /* Mobile Layout Groups */
    .control-group {
      display: none;
      width: 100%;
      height: 100%;
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 110;
    }

    .control-group.active {
      display: block;
    }

    /* Post-finish: New track button (touch) */
    #btn-new-track {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(var(--pad) + var(--safe-bottom) + min(240px, 34vh));
      z-index: 140;
      pointer-events: auto;

      display: none;
      height: 52px;
      min-width: 190px;
      padding: 0 18px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.18);
      background: rgba(255, 255, 255, 0.10);
      color: rgba(255, 255, 255, 0.95);
      font-weight: 950;
      letter-spacing: 0.08em;
      user-select: none;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.28);
    }

    #btn-new-track:active {
      transform: translateX(-50%) scale(0.98);
      background: rgba(255, 255, 255, 0.16);
    }

    /* Shared button styling */
    .mobile-button {
      width: var(--btn);
      height: var(--btn);
      background: rgba(255, 255, 255, 0.08);
      border: 2px solid rgba(255, 255, 255, 0.16);
      border-radius: 18px;
      color: rgba(255, 255, 255, 0.92);
      font-weight: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.06em;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-drag: none;
      touch-action: none;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.28);
    }

    .mobile-button:active {
      background: rgba(255, 255, 255, 0.16);
      transform: scale(0.98);
    }

    /* Driver UI */
    #steering-zone {
      position: absolute;
      left: calc(var(--pad) + var(--safe-left));
      bottom: calc(var(--pad) + var(--safe-bottom));
      width: var(--joy);
      height: var(--joy);
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.045);
      border: 2px solid rgba(255, 255, 255, 0.10);
      pointer-events: auto;
    }

    #joystick-knob {
      width: var(--joy-knob);
      height: var(--joy-knob);
      background: rgba(255, 255, 255, 0.18);
      border: 2px solid rgba(255, 255, 255, 0.34);
      border-radius: 999px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.02s linear;
    }

    #pedals-zone {
      position: absolute;
      right: calc(var(--pad) + var(--safe-right));
      bottom: calc(var(--pad) + var(--safe-bottom));
      display: flex;
      flex-direction: column;
      gap: clamp(10px, 1.8vmin, 16px);
      pointer-events: auto;
      align-items: flex-end;
    }

    #btn-throttle {
      background: rgba(84, 255, 130, 0.12);
      border-color: rgba(84, 255, 130, 0.25);
    }

    #btn-brake {
      background: rgba(255, 92, 92, 0.14);
      border-color: rgba(255, 92, 92, 0.28);
    }

    #btn-handbrake {
      width: var(--btn-sm);
      height: var(--btn-sm);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.18);
      font-size: 10px;
    }

    /* Navigator UI */
    #aim-zone {
      position: absolute;
      left: calc(var(--pad) + var(--safe-left));
      right: calc(var(--pad) + var(--safe-right));
      bottom: calc(var(--pad) + var(--safe-bottom));
      top: calc(44px + var(--pad) + var(--safe-top));
      border-radius: 16px;
      background: transparent;
      border: none;
      pointer-events: auto;
      z-index: 110;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      touch-action: none;
    }

    /* Navigator weapon buttons float bottom-right; shooting is tap/hold anywhere in aim-zone */
    #weapon-zone {
      position: absolute;
      right: calc(var(--pad) + var(--safe-right));
      bottom: calc(var(--pad) + var(--safe-bottom));
      display: flex;
      gap: 10px;
      pointer-events: auto;
      z-index: 170;
    }

    /* Navigator bullet-time button (bottom-left) */
    #bullet-time-zone {
      position: absolute;
      left: calc(var(--pad) + var(--safe-left));
      bottom: calc(var(--pad) + var(--safe-bottom));
      pointer-events: auto;
      z-index: 180;
    }

    #btn-bullet-time {
      width: var(--btn-sm);
      height: var(--btn-sm);
      border-radius: 14px;
      background: rgba(120, 160, 255, 0.14);
      border-color: rgba(120, 160, 255, 0.28);
      font-size: 10px;
      letter-spacing: 0.02em;
    }

    #btn-bullet-time.used {
      opacity: 0.38;
      filter: saturate(0.35);
    }

    .mobile-button.weapon {
      width: var(--btn-sm);
      height: var(--btn-sm);
      border-radius: 14px;
      font-size: 10px;
      letter-spacing: 0.02em;
    }

    .mobile-button.weapon.active {
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(255, 255, 255, 0.34);
      color: rgba(255, 255, 255, 0.96);
    }

    /* Always-visible FPS counter */
    #fps-counter {
      position: absolute;
      top: 8px;
      right: 8px;
      z-index: 150;
      font-size: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      color: rgba(255, 255, 255, 0.7);
      background: rgba(0, 0, 0, 0.4);
      padding: 2px 6px;
      border-radius: 4px;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <div id="app">
    <canvas id="game"></canvas>

    <div id="fps-counter">-- FPS</div>

    <button id="btn-reset" type="button">RESET</button>
    <button id="btn-new-track" type="button">NEW TRACK</button>

      <div id="finish-panel">
        <div class="card">
          <div class="title">CONTRACT COMPLETE</div>
          <div class="sub" id="finish-sub">Time: -- | Track: --</div>

          <div class="row" id="finish-row-submit">
            <input id="finish-name" class="name-input" type="text" placeholder="Name" maxlength="40" />
            <button id="finish-submit" class="finish-btn" type="button">SUBMIT SCORE</button>
          </div>

          <div class="row" id="finish-row-vote">
            <button id="finish-vote-up" class="finish-btn up" type="button">üëç UPVOTE TRACK</button>
            <button id="finish-vote-down" class="finish-btn down" type="button">üëé DOWNVOTE TRACK</button>
          </div>

          <div class="row" id="finish-row-nav">
            <button id="finish-new-track" class="finish-btn secondary" type="button">NEW TRACK</button>
          </div>

          <div id="finish-record" class="hint"></div>
          <div id="finish-msg" class="hint"></div>
          <div id="finish-board" class="board"></div>
        </div>
      </div>

    <div id="start-menu">
      <div class="card">
        <div class="game-name" aria-label="Space Delivery ‚Äî SCRAPS">SPACE DELIVERY <span class="sub">‚Äî SCRAPS</span></div>
        <div class="logo-wrap" aria-label="SCRAPS">
          <svg class="scraps-logo" viewBox="0 0 920 240" role="img" aria-label="SCRAPS" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="scrapsSteel" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#e9eef6" stop-opacity="0.92" />
                <stop offset="0.45" stop-color="#9099a7" stop-opacity="0.9" />
                <stop offset="1" stop-color="#cfd6e1" stop-opacity="0.92" />
              </linearGradient>

              <linearGradient id="scrapsSteelDark" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0" stop-color="#3b424f" stop-opacity="0.95" />
                <stop offset="1" stop-color="#141922" stop-opacity="0.95" />
              </linearGradient>

              <linearGradient id="scrapsRust" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0" stop-color="#8b3f24" stop-opacity="0.9" />
                <stop offset="0.45" stop-color="#c86c33" stop-opacity="0.88" />
                <stop offset="1" stop-color="#532516" stop-opacity="0.9" />
              </linearGradient>

              <linearGradient id="scrapsTape" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0" stop-color="#d7dde6" stop-opacity="0.68" />
                <stop offset="0.55" stop-color="#c4cad4" stop-opacity="0.62" />
                <stop offset="1" stop-color="#e6ebf3" stop-opacity="0.66" />
              </linearGradient>

              <pattern id="hazard" width="18" height="18" patternUnits="userSpaceOnUse" patternTransform="rotate(-18)">
                <rect width="18" height="18" fill="#0b0d12" opacity="0.7" />
                <rect x="0" y="0" width="9" height="18" fill="#fbbf24" opacity="0.92" />
              </pattern>

              <filter id="scrapsRough" x="-10%" y="-14%" width="120%" height="128%">
                <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="2" seed="9" result="noise" />
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" xChannelSelector="R" yChannelSelector="G" />
              </filter>

              <filter id="scrapsShadow" x="-20%" y="-40%" width="140%" height="180%">
                <feDropShadow dx="0" dy="12" stdDeviation="10" flood-color="#000" flood-opacity="0.55" />
              </filter>

              <filter id="scrapsGrain" x="-12%" y="-18%" width="124%" height="136%">
                <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="2" seed="3" result="g" />
                <feColorMatrix in="g" type="matrix"
                  values="0 0 0 0 0.6
                          0 0 0 0 0.6
                          0 0 0 0 0.6
                          0 0 0 0.22 0" result="grain" />
                <feBlend in="SourceGraphic" in2="grain" mode="overlay" />
              </filter>

              <g id="bolt">
                <circle r="6" fill="#0b0d12" opacity="0.55" />
                <circle r="3" fill="#e5e7eb" opacity="0.72" />
              </g>
            </defs>

            <!-- backplate -->
            <g filter="url(#scrapsShadow)" opacity="0.96">
              <path d="M 44 22 L 878 22
                       C 898 22 910 34 910 54
                       L 910 194
                       C 910 214 898 226 878 226
                       L 66 226
                       C 46 226 34 214 34 194
                       L 34 72
                       C 34 56 40 44 52 34
                       C 60 26 68 22 84 22 Z"
                    fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.14)" stroke-width="2" />
            </g>

            <!-- tiles: each letter is on its own bent plate (more readable) -->
            <g filter="url(#scrapsGrain)" opacity="0.98">
              <g transform="translate(90 54) rotate(-2 58 78)" filter="url(#scrapsRough)">
                <rect x="0" y="0" width="116" height="156" rx="18" fill="url(#scrapsSteel)" stroke="rgba(0,0,0,0.55)" stroke-width="4" />
                <path d="M 10 138 C 24 120, 48 118, 64 136 C 50 154, 28 156, 10 138 Z" fill="url(#scrapsRust)" opacity="0.55" />
                <g transform="translate(16 18)"><use href="#bolt" /></g>
                <g transform="translate(100 18)"><use href="#bolt" /></g>
                <g transform="translate(16 140)"><use href="#bolt" /></g>
                <g transform="translate(100 140)"><use href="#bolt" /></g>
                <text x="58" y="84" text-anchor="middle" dominant-baseline="middle"
                  font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                  font-weight="1000" font-size="74" letter-spacing="0.02em"
                  fill="url(#scrapsSteelDark)" stroke="rgba(0,0,0,0.45)" stroke-width="3">S</text>
              </g>

              <g transform="translate(220 50) rotate(1.6 58 78)" filter="url(#scrapsRough)">
                <rect x="0" y="0" width="116" height="156" rx="18" fill="url(#scrapsSteel)" stroke="rgba(0,0,0,0.55)" stroke-width="4" />
                <path d="M 18 40 C 40 22, 70 26, 82 50 C 62 68, 36 62, 18 40 Z" fill="url(#scrapsRust)" opacity="0.5" />
                <g transform="translate(16 18)"><use href="#bolt" /></g>
                <g transform="translate(100 18)"><use href="#bolt" /></g>
                <g transform="translate(16 140)"><use href="#bolt" /></g>
                <g transform="translate(100 140)"><use href="#bolt" /></g>
                <text x="58" y="84" text-anchor="middle" dominant-baseline="middle"
                  font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                  font-weight="1000" font-size="74" letter-spacing="0.02em"
                  fill="url(#scrapsSteelDark)" stroke="rgba(0,0,0,0.45)" stroke-width="3">C</text>
              </g>

              <g transform="translate(350 56) rotate(-1.1 58 78)" filter="url(#scrapsRough)">
                <rect x="0" y="0" width="116" height="156" rx="18" fill="url(#scrapsSteel)" stroke="rgba(0,0,0,0.55)" stroke-width="4" />
                <path d="M 66 140 C 78 124, 96 124, 106 140 C 92 156, 76 156, 66 140 Z" fill="url(#scrapsRust)" opacity="0.55" />
                <g transform="translate(16 18)"><use href="#bolt" /></g>
                <g transform="translate(100 18)"><use href="#bolt" /></g>
                <g transform="translate(16 140)"><use href="#bolt" /></g>
                <g transform="translate(100 140)"><use href="#bolt" /></g>
                <text x="58" y="84" text-anchor="middle" dominant-baseline="middle"
                  font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                  font-weight="1000" font-size="74" letter-spacing="0.02em"
                  fill="url(#scrapsSteelDark)" stroke="rgba(0,0,0,0.45)" stroke-width="3">R</text>
              </g>

              <g transform="translate(480 50) rotate(2.2 58 78)" filter="url(#scrapsRough)">
                <rect x="0" y="0" width="116" height="156" rx="18" fill="url(#scrapsSteel)" stroke="rgba(0,0,0,0.55)" stroke-width="4" />
                <path d="M 16 130 C 30 112, 56 112, 72 130 C 56 148, 30 150, 16 130 Z" fill="url(#scrapsRust)" opacity="0.5" />
                <g transform="translate(16 18)"><use href="#bolt" /></g>
                <g transform="translate(100 18)"><use href="#bolt" /></g>
                <g transform="translate(16 140)"><use href="#bolt" /></g>
                <g transform="translate(100 140)"><use href="#bolt" /></g>
                <text x="58" y="84" text-anchor="middle" dominant-baseline="middle"
                  font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                  font-weight="1000" font-size="74" letter-spacing="0.02em"
                  fill="url(#scrapsSteelDark)" stroke="rgba(0,0,0,0.45)" stroke-width="3">A</text>
              </g>

              <g transform="translate(610 56) rotate(-1.8 58 78)" filter="url(#scrapsRough)">
                <rect x="0" y="0" width="116" height="156" rx="18" fill="url(#scrapsSteel)" stroke="rgba(0,0,0,0.55)" stroke-width="4" />
                <path d="M 18 46 C 36 34, 60 36, 74 54 C 60 68, 34 64, 18 46 Z" fill="url(#scrapsRust)" opacity="0.52" />
                <g transform="translate(16 18)"><use href="#bolt" /></g>
                <g transform="translate(100 18)"><use href="#bolt" /></g>
                <g transform="translate(16 140)"><use href="#bolt" /></g>
                <g transform="translate(100 140)"><use href="#bolt" /></g>
                <text x="58" y="84" text-anchor="middle" dominant-baseline="middle"
                  font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                  font-weight="1000" font-size="74" letter-spacing="0.02em"
                  fill="url(#scrapsSteelDark)" stroke="rgba(0,0,0,0.45)" stroke-width="3">P</text>
              </g>

              <g transform="translate(740 52) rotate(1.1 58 78)" filter="url(#scrapsRough)">
                <rect x="0" y="0" width="116" height="156" rx="18" fill="url(#scrapsSteel)" stroke="rgba(0,0,0,0.55)" stroke-width="4" />
                <path d="M 72 142 C 84 126, 104 126, 112 142 C 100 158, 84 158, 72 142 Z" fill="url(#scrapsRust)" opacity="0.55" />
                <g transform="translate(16 18)"><use href="#bolt" /></g>
                <g transform="translate(100 18)"><use href="#bolt" /></g>
                <g transform="translate(16 140)"><use href="#bolt" /></g>
                <g transform="translate(100 140)"><use href="#bolt" /></g>
                <text x="58" y="84" text-anchor="middle" dominant-baseline="middle"
                  font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                  font-weight="1000" font-size="74" letter-spacing="0.02em"
                  fill="url(#scrapsSteelDark)" stroke="rgba(0,0,0,0.45)" stroke-width="3">S</text>
              </g>
            </g>

            <!-- hazard patch (corporate attempt at professionalism) -->
            <g opacity="0.92" transform="translate(0,0) rotate(-2 460 198)">
              <rect x="310" y="184" width="300" height="30" rx="10" fill="url(#hazard)" stroke="rgba(0,0,0,0.55)" stroke-width="3" />
              <text x="460" y="204" text-anchor="middle" dominant-baseline="middle"
                font-family="ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
                font-weight="950" font-size="13" letter-spacing="0.24em" fill="rgba(10,13,18,0.92)">
                DELIVERY DIVISION
              </text>
            </g>

            <!-- duct tape band holding it together -->
            <g opacity="0.96" transform="rotate(6 460 120)" filter="url(#scrapsRough)">
              <path d="M 120 122
                       C 210 92, 360 96, 460 120
                       C 560 144, 700 144, 800 112
                       L 816 142
                       C 712 176, 560 178, 452 150
                       C 340 120, 210 120, 144 150 Z"
                    fill="url(#scrapsTape)" stroke="rgba(0,0,0,0.5)" stroke-width="2" />
              <path d="M 220 142 L 244 126" stroke="rgba(0,0,0,0.35)" stroke-width="2" />
              <path d="M 520 156 L 546 136" stroke="rgba(0,0,0,0.35)" stroke-width="2" />
              <path d="M 710 146 L 734 130" stroke="rgba(0,0,0,0.35)" stroke-width="2" />
            </g>
          </svg>
        </div>
        <div class="corp-tag">SPACE DELIVERY <span class="tiny">SCRAPS ‚Äî Salvage Contracts &amp; Risk-Adjusted Procurement Service</span></div>
        <div id="start-menu-sub" class="sub"></div>

        <!-- Entry point: pick Singleplayer / Multiplayer -->
        <div id="menu-root">
          <div class="row">
            <button id="btn-menu-singleplayer" class="menu-btn" type="button">SINGLEPLAYER</button>
          </div>
          <div class="row">
            <button id="btn-menu-multiplayer" class="menu-btn" type="button">MULTIPLAYER</button>
          </div>
        </div>

        <!-- Singleplayer submenu -->
        <div id="menu-singleplayer" style="display:none;">
          <div class="row">
            <button id="btn-sp-time-trial" class="menu-btn" type="button">TIME TRIAL</button>
          </div>
          <div class="row">
            <button id="btn-sp-practice" class="menu-btn" type="button" style="background:#334155;color:rgba(255,255,255,0.95);">DRIVING PRACTICE</button>
          </div>
          <div class="row" style="margin-top: 10px;">
            <button id="btn-sp-back" class="menu-btn" type="button" style="background:#374151;color:rgba(255,255,255,0.95);">BACK</button>
          </div>
        </div>

        <!-- Multiplayer submenu (existing UI) -->
        <div id="menu-multiplayer" style="display:none;">
          <div class="row">
            <button id="btn-host-driver" class="menu-btn" type="button">START MULTIPLAYER (YOU ARE THE DRIVER)</button>
          </div>

          <div id="mp-host" style="display:none;">
            <div class="code" id="mp-code">0000</div>
            <div class="hint" id="mp-host-hint">Tell your gunner this code.</div>
          </div>

          <div class="divider"></div>

          <div class="row" id="mp-join-cta">
            <button id="btn-join-codriver" class="menu-btn" type="button">JOIN MULTIPLAYER (AS GUNNER)</button>
          </div>

          <div id="mp-join-form" style="display:none;">
            <div class="row" style="margin-top: 10px;">
              <input id="mp-join-code" class="code-input" inputmode="numeric" autocomplete="one-time-code" placeholder="1234" maxlength="4" />
              <button id="btn-join-confirm" class="menu-btn" type="button">JOIN</button>
            </div>
            <div class="row" style="margin-top: 10px;">
              <button id="btn-join-back" class="menu-btn" type="button" style="background:#374151;color:rgba(255,255,255,0.95);">BACK</button>
            </div>
          </div>

          <div id="mp-error" class="error"></div>

          <div id="mp-reconnect" class="row" style="display:none; margin-top: 10px;">
            <button id="btn-reconnect" class="menu-btn" type="button" style="background:#16a34a;">RECONNECT</button>
          </div>

          <div class="row" style="margin-top: 10px;">
            <button id="btn-mp-back" class="menu-btn" type="button" style="background:#374151;color:rgba(255,255,255,0.95);">BACK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="net-panel">
      <button id="net-invite" type="button">INVITE PLAYER</button>
      <div id="net-room-container">
        <input id="net-room" type="hidden" />
        <button id="net-create" type="button"></button>
        <button id="net-join" type="button"></button>
        <button id="net-copy" type="button"></button>
      </div>
      <div id="net-status-container">
        <div id="net-status"></div>
      </div>
    </div>
    <div id="mobile-overlay">
      <div id="mobile-rotate">
        <div class="card">
          <div class="title">Rotate to landscape</div>
          <div class="sub">Touch controls are designed for landscape play. Portrait mode feels cramped and misaligned on many phones.</div>
        </div>
      </div>

        <button id="role-toggle" type="button">Driver</button>
        <button id="fullscreen-toggle" type="button" aria-label="Toggle fullscreen">FULL</button>

      <div id="bullet-time-zone">
        <div id="btn-bullet-time" class="mobile-button" title="Bullet-time (hold, 30s per map)">SLOW</div>
      </div>
      <!-- Driver Controls -->
      <div id="driver-group" class="control-group active">
        <div id="steering-zone" class="touch-auto">
          <div id="joystick-knob"></div>
        </div>
        <div id="pedals-zone" class="touch-auto">
          <div id="btn-throttle" class="mobile-button">GAS</div>
          <div id="btn-brake" class="mobile-button">BRK</div>
          <div id="btn-handbrake" class="mobile-button">HB</div>
        </div>
      </div>

      <!-- Navigator Controls -->
      <div id="navigator-group" class="control-group">
        <div id="aim-zone" class="touch-auto"></div>
        <div id="ammo-display"></div>
        <div id="weapon-zone" class="touch-auto">
          <div class="mobile-button weapon" data-weapon-index="0">HG</div>
          <div class="mobile-button weapon" data-weapon-index="1">RIF</div>
          <div class="mobile-button weapon" data-weapon-index="2">AK</div>
          <div class="mobile-button weapon" data-weapon-index="3">SHT</div>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.ts"></script>
</body>

</html>